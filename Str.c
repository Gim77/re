// Str.c
// implemenation of Str.h

#include <assert.h>
#include <inttypes.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "Str.h"

#define T Str_T

////////////////////////////////////////////////////////////////////////////////
// strings identifying types
////////////////////////////////////////////////////////////////////////////////

static char strInt16[] = "int16_t";

////////////////////////////////////////////////////////////////////////////////
// fail
////////////////////////////////////////////////////////////////////////////////

static void fail(char * msg) 
{
  fprintf(stderr, "%s\n", msg);
  exit(1);
}

////////////////////////////////////////////////////////////////////////////////
// Str_free
////////////////////////////////////////////////////////////////////////////////

void Str_free(T *selfP)
{
  assert(selfP);
  assert(*selfP);

  T self = *selfP;
  free(self);

  *selfP = NULL;
}


////////////////////////////////////////////////////////////////////////////////
// Str_newFromInt16
////////////////////////////////////////////////////////////////////////////////

T Str_newFromInt16(int16_t value)
{
  T self = malloc(sizeof(struct T));
  if (!self)
    fail("Str_newFromInt16: unable to allocate self");

  self->valueTypeName = "int16_t";
  self->value.valueInt16 = value;
  self->zero = '\0';

  return self;
}

////////////////////////////////////////////////////////////////////////////////
// Str_str
////////////////////////////////////////////////////////////////////////////////

char *Str_str(T self)
{
  assert(self);
  return &self->value.c;
}

////////////////////////////////////////////////////////////////////////////////
// Str_valueInt16
////////////////////////////////////////////////////////////////////////////////

int16_t Str_valueInt16(T self)
{
  assert(self);
  if (strcmp(strInt16, self->valueTypeName) != 0) {
    fprintf(stderr, "Str_valueInt16: value is of type %s, not int16_t", 
            self->valueTypeName);
    exit(1);
  }
  return self->value.valueInt16;
}
